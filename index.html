<!DOCTYPE html>

<html>
<head>
	<title>Rigid body - Physijs</title>
	
	<link rel="stylesheet" type="text/css" href="css/styles.css" />
	
	<script type="text/javascript" src="js/three.min.js"></script>
	<script type="text/javascript" src="js/physi.js"></script>
	
	<script type="text/javascript">
	
	'use strict';
	
	Physijs.scripts.worker = 'physijs_worker.js';
	Physijs.scripts.ammo = 'js/ammo.js';

	var initScene, render, applyForce, setMousePosition, mouse_position,
		groundMaterial, boxMaterial,
		projector, renderer, scene, ground, light, camera, manatee;

    var delayer = 0;

	initScene = function() {
		projector = new THREE.Projector;
		
		renderer = new THREE.WebGLRenderer({ antialias: false });
		renderer.setSize(window.innerWidth, window.innerHeight);
		renderer.shadowMapEnabled = true;
		renderer.shadowMapSoft = true;
		document.getElementById('viewport').appendChild(renderer.domElement);
				
		scene = new Physijs.Scene();
		scene.setGravity(new THREE.Vector3(0, -30, 0));

		scene.addEventListener('update', function() {

		});
		
		camera = new THREE.PerspectiveCamera(35, window.innerWidth / window.innerHeight, 1, 1000);
		camera.position.set(200, 50, 0);
		camera.lookAt(scene.position);
		scene.add(camera);
		
		// Light
		light = new THREE.DirectionalLight(0xFFFFFF);
		light.position.set(20, 40, -15);
		light.target.position.copy(scene.position);
		light.castShadow = true;
		light.shadowCameraLeft = -60;
		light.shadowCameraTop = -60;
		light.shadowCameraRight = 60;
		light.shadowCameraBottom = 60;
		light.shadowCameraNear = 20;
		light.shadowCameraFar = 200;
		light.shadowBias = -.0001
		light.shadowMapWidth = light.shadowMapHeight = 2048;
		light.shadowDarkness = .5;
		scene.add(light);

		groundMaterial = Physijs.createMaterial(
			new THREE.MeshLambertMaterial({ map: THREE.ImageUtils.loadTexture('images/rocks.jpg') }), .8, .4
		);

		boxMaterial = Physijs.createMaterial(
			new THREE.MeshLambertMaterial({ map: THREE.ImageUtils.loadTexture('images/plywood.jpg') }), .4, .6
		);

		ground = new Physijs.BoxMesh(new THREE.CubeGeometry(1000, 1, 200), groundMaterial, 0);
		ground.receiveShadow = true;
		ground.rotation.z = -0.1;
		scene.add(ground);
		
		manatee = new Physijs.SphereMesh(new THREE.SphereGeometry(10, 10, 10), boxMaterial);
		manatee.position.set(20, 20, 20);
		manatee.scale.set(1, 1, 1);

		manatee.castShadow = true;
		scene.add(manatee);

		requestAnimationFrame(render);
	};
	
	render = function() {
        renderer.render(scene, camera);
        scene.simulate(undefined, 1);
        console.log(manatee.position);
        requestAnimationFrame(render);
	};
	
	window.onload = initScene;
	
	</script>
</head>

<body>
	<div id="viewport"></div>
</body>

</html>
